# 当日シグナル 30 分達成計画

## 現状分析

- **目標**: 30 分以内
- **現状**: 99 分 54 秒（System6 単体）
- **必要な改善**: 約 70%の時間短縮

## 最適化戦略

### 1. インジケーター事前計算の活用 🎯 **最重要**

**問題**: 59 分 15 秒でインジケーター再計算
**解決策**:

- `prefer_precomputed_indicators=True` の完全活用
- rolling キャッシュの指標を 100%信頼して使用
- 再計算を最小限に抑制

**期待効果**: 40-50 分短縮

### 2. バッチサイズ最適化

**問題**: バッチサイズ 25 で 35-45 秒/バッチ
**解決策**:

- バッチサイズを 100-200 に増加
- I/O 待機時間を削減

**期待効果**: 15-20 分短縮

### 3. 早期フィルタリング強化

**問題**: 2351 銘柄すべてを処理
**解決策**:

- 基本フィルタ（価格、出来高）を事前適用
- 明らかに条件を満たさない銘柄を早期除外

**期待効果**: 10-15 分短縮

### 4. System6 専用高速化

**解決策**:

- System6 用の専用最適化パス作成
- ショート戦略特有の処理に特化
- 不要な計算処理をスキップ

**期待効果**: 5-10 分短縮

## 実装優先度

### Phase 1: インジケーター事前計算（最優先）

```python
# core/system6.py の修正
def prepare_data_vectorized_system6(df, reuse_indicators=True):
    if reuse_indicators and has_required_indicators(df):
        return use_precomputed_indicators(df)  # 再計算なし
    else:
        # 最小限の再計算のみ
        return minimal_recalculation(df)
```

### Phase 2: バッチサイズ最適化

```python
# strategies/system6_strategy.py
OPTIMAL_BATCH_SIZE = 200  # 25から200に変更
```

### Phase 3: フィルタリング強化

```python
# 事前フィルタで80%の銘柄を除外
early_filter = (price >= 5) & (volume >= 25000000)
```

## 目標タイムライン

- **インジケーター計算**: 59 分 → 10 分 (85%短縮)
- **候補抽出**: 24 分 → 15 分 (40%短縮)
- **合計目標**: 25 分以内

## リスク

- インジケーターの精度低下の可能性
- フィルタリング強化による候補減少

## 検証方法

1. 小規模テスト（100 銘柄）で効果測定
2. 段階的な最適化適用
3. 結果の品質検証
