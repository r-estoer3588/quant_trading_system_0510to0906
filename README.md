# Quant Trading System (Streamlit)

Streamlit ãƒ™ãƒ¼ã‚¹ã®ã‚¢ãƒ—ãƒªã§ 7 ã¤ã®å£²è²·ã‚·ã‚¹ãƒ†ãƒ ã‚’å¯è¦–åŒ–ãƒ»ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚

## ğŸ“š ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

è©³ç´°ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ **[docs/](./docs/)** ãƒ•ã‚©ãƒ«ãƒ€ã«æ•´ç†ã•ã‚Œã¦ã„ã¾ã™ï¼š

- ğŸš€ **[ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ](./docs/#quick-start)** - åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‹ã‚‰åŸºæœ¬æ“ä½œã¾ã§
- ğŸ“Š **[ã‚·ã‚¹ãƒ†ãƒ ä»•æ§˜](./docs/systems/)** - System1-7 ã®è©³ç´°ä»•æ§˜ã¨è³‡ç”£é…åˆ†
- ğŸ”§ **[æŠ€è¡“æ–‡æ›¸](./docs/technical/)** - ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ»æŒ‡æ¨™è¨ˆç®—ãƒ»å‡¦ç†ãƒ•ãƒ­ãƒ¼
- ğŸƒ **[é‹ç”¨ã‚¬ã‚¤ãƒ‰](./docs/operations/)** - è‡ªå‹•å®Ÿè¡Œãƒ»é€šçŸ¥ãƒ»ç›£è¦–è¨­å®š
- ğŸ¤– **[AI é€£æº](./docs/technical/mcp_integration_plan.md)** - MCP çµ±åˆã¨ VS Code é€£æº

> **[ğŸ“‹ çµ±åˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç›®æ¬¡ã¯ã“ã¡ã‚‰](./docs/README.md)**

---

## ğŸ‰ æ–°æ©Ÿèƒ½: Diagnostics API

Phase0-7 ã§å°å…¥ã•ã‚ŒãŸ **Diagnostics API** ã«ã‚ˆã‚Šã€å„ã‚·ã‚¹ãƒ†ãƒ ã®å€™è£œç”Ÿæˆãƒ—ãƒ­ã‚»ã‚¹ã‚’è©³ç´°ã«è¿½è·¡ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

### ä¸»ãªè¨ºæ–­ã‚­ãƒ¼

ã™ã¹ã¦ã®ã‚·ã‚¹ãƒ†ãƒ (System1-7)ã§ä»¥ä¸‹ã®çµ±ä¸€ã‚­ãƒ¼ãŒå–å¾—ã§ãã¾ã™:

- `setup_predicate_count`: Setup æ¡ä»¶ã‚’æº€ãŸã—ãŸè¡Œæ•°
- `final_top_n_count`: æœ€çµ‚å€™è£œä»¶æ•°(ãƒ©ãƒ³ã‚­ãƒ³ã‚°å¾Œ)
- `ranking_source`: `"latest_only"` ã¾ãŸã¯ `"full_scan"`

ã“ã‚Œã«ã‚ˆã‚Šã€å€™è£œãŒã©ã®ã‚ˆã†ã«çµã‚Šè¾¼ã¾ã‚ŒãŸã‹ã‚’æ˜ç¢ºã«æŠŠæ¡ã§ãã€ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚„æ¤œè¨¼ãŒå®¹æ˜“ã«ãªã‚Šã¾ã™ã€‚

### ä½¿ç”¨ä¾‹

```python
from core.system1 import generate_system1_candidates

candidates, diagnostics = generate_system1_candidates(df, current_date, latest_only=True)

print(diagnostics)
# {
#   "ranking_source": "latest_only",
#   "setup_predicate_count": 5,
#   "final_top_n_count": 3,
#   ...
# }
```

### Snapshot Export

Mini ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡Œå¾Œã«è¨ºæ–­æƒ…å ±ã‚’ JSON å½¢å¼ã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå¯èƒ½:

```bash
python scripts/run_all_systems_today.py --test-mode mini --skip-external
cat results_csv_test/diagnostics_snapshot_*.json | jq '.systems'
```

### å·®åˆ†æ¯”è¼ƒãƒ„ãƒ¼ãƒ«

2 ã¤ã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’æ¯”è¼ƒã—ã¦ã€è¨ºæ–­æƒ…å ±ã®å¤‰åŒ–ã‚’æ¤œå‡º:

```bash
python tools/compare_diagnostics_snapshots.py \
  --baseline baseline.json \
  --current current.json \
  --output diff.json \
  --summary
```

**è©³ç´°ã¯ [docs/technical/diagnostics.md](./docs/technical/diagnostics.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚**

---

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

1. ä»®æƒ³ç’°å¢ƒã‚’ä½œæˆã—ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«:

```bash
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
```

2. `.env` ã‚’ç”¨æ„ã— `EODHD_API_KEY` ã«åŠ ãˆã€Alpaca é€£æºã‚’è¡Œã†å ´åˆã¯
   `APCA_API_KEY_ID` ã¨ `APCA_API_SECRET_KEY` ã‚’è¨­å®šã—ã¾ã™ã€‚

### ä¸»è¦ãªç’°å¢ƒå¤‰æ•°

- `EODHD_API_KEY`: EOD Historical Data API ã‚­ãƒ¼ï¼ˆå¿…é ˆï¼‰
- `APCA_API_KEY_ID`, `APCA_API_SECRET_KEY`: Alpaca ãƒ–ãƒ­ãƒ¼ã‚«ãƒ¼é€£æºç”¨
- `SLACK_WEBHOOK_URL` ã¾ãŸã¯ `SLACK_BOT_TOKEN`+`SLACK_CHANNEL`: Slack é€šçŸ¥è¨­å®š
- `DISCORD_WEBHOOK_URL`: Discord é€šçŸ¥è¨­å®š

### ãƒ­ã‚°ãƒ»é€²æ—é–¢é€£ã®ç’°å¢ƒå¤‰æ•°

- `COMPACT_TODAY_LOGS`: å½“æ—¥ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®è©³ç´°ãƒ­ã‚°ã‚’æŠ‘åˆ¶ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: falseï¼‰
- `ENABLE_PROGRESS_EVENTS`: é€²æ—ã‚¤ãƒ™ãƒ³ãƒˆå‡ºåŠ›ã‚’æœ‰åŠ¹åŒ–ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: falseï¼‰
- `TODAY_SIGNALS_LOG_MODE`: ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«åå½¢å¼ï¼ˆ`single` ã¾ãŸã¯ `dated`ï¼‰
- `ROLLING_ISSUES_VERBOSE_HEAD`: Rolling ã‚­ãƒ£ãƒƒã‚·ãƒ¥å•é¡Œã®è©³ç´°è¡¨ç¤ºä»¶æ•°
- `RUN_PLANNED_EXITS`: è‡ªå‹•æ‰‹ä»•èˆã„å®Ÿè¡Œãƒ¢ãƒ¼ãƒ‰ï¼ˆ`off`/`open`/`close`/`auto`ï¼‰

## å®Ÿè¡Œä¾‹

### åŸºæœ¬å®Ÿè¡Œ

- UI: `streamlit run apps/app_integrated.py`
- Alpaca ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰: `streamlit run app_alpaca_dashboard.py`
- å½“æ—¥ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³: `python scripts/run_all_systems_today.py --parallel --save-csv`

### ãƒ­ã‚°æœ€é©åŒ–æ©Ÿèƒ½

å½“æ—¥ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ãƒ­ã‚°å‡ºåŠ›ã‚’åˆ¶å¾¡ã™ã‚‹ç’°å¢ƒå¤‰æ•°ï¼š

```bash
# ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆãƒ­ã‚°ãƒ¢ãƒ¼ãƒ‰ï¼ˆè©³ç´°ãƒ­ã‚°ã‚’DEBUGãƒ¬ãƒ™ãƒ«ã«å¤‰æ›´ï¼‰
COMPACT_TODAY_LOGS=1 python scripts/run_all_systems_today.py

# é€²æ—ã‚¤ãƒ™ãƒ³ãƒˆå‡ºåŠ›æœ‰åŠ¹åŒ–ï¼ˆUIã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–å¯èƒ½ï¼‰
ENABLE_PROGRESS_EVENTS=1 python scripts/run_all_systems_today.py

# Rolling ã‚­ãƒ£ãƒƒã‚·ãƒ¥å•é¡Œã®è©³ç´°è¡¨ç¤ºä»¶æ•°åˆ¶é™
ROLLING_ISSUES_VERBOSE_HEAD=5 python scripts/run_all_systems_today.py

# å…¨ã¦åŒæ™‚ä½¿ç”¨
COMPACT_TODAY_LOGS=1 ENABLE_PROGRESS_EVENTS=1 ROLLING_ISSUES_VERBOSE_HEAD=3 \
    python scripts/run_all_systems_today.py --parallel --save-csv
```

### ãã®ä»–ã®å®Ÿè¡Œä¾‹

- æ—¥æ¬¡ã‚­ãƒ£ãƒƒã‚·ãƒ¥: `python scripts/cache_daily_data.py`
  - ä¸¦åˆ—åº¦èª¿æ•´: `--max-workers 20` (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 20)
  - API å–å¾—ä¸¦åˆ—åº¦: `--fetch-workers 1` (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 1ã€é †æ¬¡å®Ÿè¡Œã§ãƒ¬ãƒ¼ãƒˆåˆ¶é™éµå®ˆ)
  - ä¿å­˜ä¸¦åˆ—åº¦: `--save-workers` (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: max_workers)
  - ã‚¹ãƒ­ãƒƒãƒˆãƒªãƒ³ã‚°: `--throttle-seconds 0.0667` (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 0.0667 ç§’ã€ç´„ 15req/secã€å…¬å¼åˆ¶é™ 1000req/min ä»¥å†…ã«åã¾ã‚‹ã‚ˆã†èª¿æ•´)
  - é€²æ—è¡¨ç¤ºé–“éš”: `--progress-interval 300` (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 300 ä»¶ã€æŒ‡å®šä»¶æ•°ã”ã¨ã«é€²æ—ã‚’è¡¨ç¤º)
  - æ³¨æ„: å¼•æ•°ã‚’æŒ‡å®šã—ãªã„ `python scripts/cache_daily_data.py` ã®æ—¢å®šå®Ÿè¡Œã¯
    å…¨éŠ˜æŸ„ã®å…¨ãƒ’ã‚¹ãƒˆãƒªã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ï¼ˆãƒ•ãƒ«å–å¾—ï¼‰ã€‚å½“æ—¥ã®ä¸€æ‹¬ï¼ˆBulkï¼‰æ›´æ–°ã‚’
    å®Ÿè¡Œã—ãŸã„å ´åˆã¯ `--bulk-today` ã‚’æŒ‡å®šã™ã‚‹ã‹ã€`scripts/update_from_bulk_last_day.py`
    ã‚’ç›´æ¥å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚
- ç°¡æ˜“ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©: `python -m schedulers.runner`

### ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€²æ—ç›£è¦–

`ENABLE_PROGRESS_EVENTS=1` ã§å½“æ—¥ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å®Ÿè¡Œä¸­ã€åŒæ™‚ã« Streamlit UI ã§é€²æ—ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–ã§ãã¾ã™ï¼š

1. ã‚¿ãƒ¼ãƒŸãƒŠãƒ« 1: å½“æ—¥ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡Œ

   ```bash
   ENABLE_PROGRESS_EVENTS=1 python scripts/run_all_systems_today.py --parallel
   ```

2. ã‚¿ãƒ¼ãƒŸãƒŠãƒ« 2: UI èµ·å‹•

   ```bash
   streamlit run apps/app_integrated.py
   ```

3. UI ã®ã€Œå½“æ—¥ã‚·ã‚°ãƒŠãƒ«ã€ã‚¿ãƒ–ã§ã€Œé€²æ—ãƒ­ã‚°ã‚’è¡¨ç¤ºã€ã‚’ãƒã‚§ãƒƒã‚¯
   - `logs/progress_today.jsonl` ã‚’ 1 ç§’é–“éš”ã§ãƒãƒ¼ãƒªãƒ³ã‚°
   - ã‚·ã‚¹ãƒ†ãƒ å®Ÿè¡Œé–‹å§‹ã€é…åˆ†å‡¦ç†ã€é€šçŸ¥å®Œäº†ãªã©ã®ä¸»è¦ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º
   - å„ã‚·ã‚¹ãƒ†ãƒ ã®å€™è£œæ•°ã€ã‚¨ãƒ³ãƒˆãƒªæ•°ã€ç¾åœ¨ãƒã‚¸ã‚·ãƒ§ãƒ³æ•°ãªã©ã®è©³ç´°æƒ…å ±ã‚‚å«ã‚€

### ãƒ­ã‚°æœ€é©åŒ–ã®åŠ¹æœ

- **é€šå¸¸ãƒ¢ãƒ¼ãƒ‰**: å…¨è©³ç´°ãƒ­ã‚°ãŒ INFO ãƒ¬ãƒ™ãƒ«ã§å‡ºåŠ›ã•ã‚Œã€å¤§é‡ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- **ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆãƒ¢ãƒ¼ãƒ‰ (`COMPACT_TODAY_LOGS=1`)**:
  - ã‚·ã‚¹ãƒ†ãƒ å†…è¨³ã‚„é€²æ—è©³ç´°ãŒ DEBUG ãƒ¬ãƒ™ãƒ«ã«å¤‰æ›´
  - ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã«ã‚ˆã‚ŠåŒç¨®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒé©åˆ‡ãªé–“éš”ï¼ˆ2-10 ç§’ï¼‰ã§å‡ºåŠ›
  - é‡è¦ãªæƒ…å ±ï¼ˆã‚¨ãƒ©ãƒ¼ã€æœ€çµ‚çµæœãªã©ï¼‰ã¯å¼•ãç¶šã INFO ãƒ¬ãƒ™ãƒ«ã§è¡¨ç¤º
  - ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒç´„ 60-80%å‰Šæ¸›ï¼ˆå®Ÿæ¸¬å€¤ï¼‰

## ãƒ†ã‚¹ãƒˆ

### å˜ä½“ãƒ†ã‚¹ãƒˆ

```bash
pytest -q
```

### ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³é«˜é€Ÿãƒ†ã‚¹ãƒˆ

å½“æ—¥ã‚·ã‚°ãƒŠãƒ« ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ (`run_all_systems_today.py`) ã®é«˜é€Ÿãƒ†ã‚¹ãƒˆç”¨ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒåˆ©ç”¨å¯èƒ½ã§ã™ã€‚

#### ãƒ†ã‚¹ãƒˆé«˜é€ŸåŒ–ã‚ªãƒ—ã‚·ãƒ§ãƒ³

- `--test-mode {mini|quick|sample}`: éŠ˜æŸ„æ•°åˆ¶é™
  - `mini`: 10 éŠ˜æŸ„ï¼ˆè¶…é«˜é€Ÿã€2 ç§’ã§å®Œäº†ï¼‰
  - `quick`: 50 éŠ˜æŸ„
  - `sample`: 100 éŠ˜æŸ„
- `--skip-external`: å¤–éƒ¨ API å‘¼ã³å‡ºã—ã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼ˆNASDAQ Traderã€pandas_market_calendars ç­‰ï¼‰
- `--benchmark`: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨ˆæ¸¬ã¨ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ

#### 4 ã¤ã®ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª

```bash
# 1. åŸºæœ¬ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãƒ†ã‚¹ãƒˆï¼ˆè¶…é«˜é€Ÿï¼š2ç§’ï¼‰
python scripts/run_all_systems_today.py --test-mode mini --skip-external --benchmark

# 2. ä¸¦åˆ—å‡¦ç†ãƒ†ã‚¹ãƒˆ
python scripts/run_all_systems_today.py --test-mode mini --skip-external --parallel --benchmark

# 3. CSVä¿å­˜æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
python scripts/run_all_systems_today.py --test-mode mini --skip-external --save-csv --benchmark

# 4. å…¨æ©Ÿèƒ½çµ±åˆãƒ†ã‚¹ãƒˆ
python scripts/run_all_systems_today.py --test-mode quick --skip-external --parallel --save-csv --benchmark
```

#### ãƒ†ã‚¹ãƒˆåŠ¹æœ

- **å®Ÿè¡Œæ™‚é–“**: åˆ†å˜ä½ â†’ **2 ç§’** (mini ãƒ¢ãƒ¼ãƒ‰)
- **å¤–éƒ¨ä¾å­˜**: API å¾…æ©Ÿæ™‚é–“ã‚’å®Œå…¨æ’é™¤
- **ã‚«ãƒãƒ¬ãƒƒã‚¸**: 8 ãƒ•ã‚§ãƒ¼ã‚ºå‡¦ç†ã€ä¸¦åˆ—å®Ÿè¡Œã€CSV å‡ºåŠ›ã‚’ç¶²ç¾…
- **ãƒ‡ãƒ¼ã‚¿è¦ä»¶**: æœ€å°é™ï¼ˆSPY 1 éŠ˜æŸ„ã§ã‚‚å‹•ä½œï¼‰

#### å®Ÿè¡Œä¾‹

```bash
# æœ€é€Ÿãƒ†ã‚¹ãƒˆï¼ˆé–‹ç™ºãƒ»CIç”¨ï¼‰
python scripts/run_all_systems_today.py --test-mode mini --skip-external --benchmark

# ä¸­è¦æ¨¡ãƒ†ã‚¹ãƒˆï¼ˆçµ±åˆæ¤œè¨¼ç”¨ï¼‰
python scripts/run_all_systems_today.py --test-mode sample --benchmark

# æœ¬ç•ªåŒç­‰ãƒ†ã‚¹ãƒˆï¼ˆãƒ‡ãƒ¼ã‚¿å®Œå‚™æ™‚ï¼‰
python scripts/run_all_systems_today.py --parallel --save-csv --benchmark
```

## è¨­å®š

å„ªå…ˆé †ä½ã¯ **JSON > YAML > .env**ï¼ˆ`config/settings.py` å®Ÿè£…ã«æº–æ‹ ï¼‰ã€‚
æ¨å¥¨: `config.yaml` ã‚’ãƒ™ãƒ¼ã‚¹ã«ã€ç§˜åŒ¿å€¤ã¯ `.env`ã€ä¸Šæ›¸ãã¯ JSON ã§ã€‚

## ãƒ­ã‚°é‹ç”¨

`logging_utils` ã«ã¦ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®šã€‚å®¹é‡ä¸Šé™ã¨æ—¥æ¬¡ãƒ­ãƒ¼ãƒ†ã®ä½¿ã„åˆ†ã‘ã‚’æ˜è¨˜ã—ã€
å¤ã„ãƒ­ã‚°ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—æ–¹é‡ã‚’è¿½åŠ ã€‚

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
â”œâ”€â”€ apps/              # Streamlit UI
â”‚   â”œâ”€â”€ app_integrated.py    # çµ±åˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
â”‚   â””â”€â”€ dashboards/          # å°‚ç”¨ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
â”œâ”€â”€ strategies/        # æˆ¦ç•¥ãƒ©ãƒƒãƒ‘ãƒ¼ã‚¯ãƒ©ã‚¹
â”œâ”€â”€ core/             # ã‚·ã‚¹ãƒ†ãƒ ç´”ãƒ­ã‚¸ãƒƒã‚¯ (system1.py - system7.py)
â”œâ”€â”€ common/           # å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ»ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆåŸºç›¤
â”œâ”€â”€ config/           # è¨­å®šç®¡ç† (settings.py, config.yaml)
â”œâ”€â”€ docs/             # ğŸ“š **çµ±åˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ** (è©³ç´°ä»•æ§˜ãƒ»æŠ€è¡“æ–‡æ›¸)
â”‚   â”œâ”€â”€ systems/           # System1-7ä»•æ§˜æ›¸
â”‚   â”œâ”€â”€ technical/         # ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ»æŒ‡æ¨™è¨ˆç®—
â”‚   â”œâ”€â”€ operations/        # é‹ç”¨ãƒ»è‡ªå‹•å®Ÿè¡Œãƒ»é€šçŸ¥
â”‚   â””â”€â”€ today_signal_scan/ # ã‚·ã‚°ãƒŠãƒ«å‡¦ç†8ãƒ•ã‚§ãƒ¼ã‚º
â”œâ”€â”€ data/             # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ãƒãƒƒãƒ”ãƒ³ã‚°
â”œâ”€â”€ scripts/          # å®Ÿè¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â””â”€â”€ tests/            # ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ
```

> **è©³ç´°ã¯ [ğŸ“‹ docs/README.md](./docs/README.md) ã‚’å‚ç…§**

## ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æœ€é©åŒ–

### ãƒ‡ãƒ¥ã‚¢ãƒ«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå¯¾å¿œ

- `data_cache/rolling/`ï¼šCSV + Feather åŒæ™‚ä¿å­˜
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ï¼šFeather å„ªå…ˆèª­ã¿å–ã‚Šã€CSV è‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
- ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºï¼šFeather ã¯ CSV ã®ç´„ 74%ï¼ˆé‡è¤‡åˆ—å‰Šé™¤åŠ¹æœï¼‰
- å¯¾å¿œç¯„å›²ï¼š6,200+éŠ˜æŸ„ã™ã¹ã¦

### é‡è¤‡åˆ—ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

- å‰Šé™¤å¯¾è±¡ï¼š`open/Open/OPEN` ç­‰ã®å†—é•·åˆ—ï¼ˆç´„ 7 åˆ—ï¼‰
- å„ªå…ˆé †ä½ï¼šPascalCase > ALL_CAPS > lowercase
- ãƒ‡ãƒ¼ã‚¿å‰Šæ¸›ï¼šåˆ—æ•°ã‚’ç´„ 40%å‰Šæ¸›ï¼ˆ58â†’35 åˆ—ï¼‰

## ã‚­ãƒ£ãƒƒã‚·ãƒ¥éšå±¤ï¼ˆbase / rolling / full_backupï¼‰

- base: æŒ‡æ¨™ä»˜ä¸æ¸ˆã¿ã®é•·æœŸãƒ‡ãƒ¼ã‚¿ï¼ˆãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆãƒ»åˆ†æã®æ—¢å®šï¼‰ã€‚
  - èª­ã¿è¾¼ã¿ãŒæœ€é€Ÿã€‚æ¬ ææ™‚ã¯å†…éƒ¨ã§å†æ§‹ç¯‰ã•ã‚Œã¾ã™ï¼ˆfull_backup/rolling ã‹ã‚‰ï¼‰ã€‚
- rolling: ç›´è¿‘ N å–¶æ¥­æ—¥ï¼ˆæ—¢å®š 300ï¼‰ã®è»½é‡ãƒ‡ãƒ¼ã‚¿ï¼ˆå½“æ—¥ã‚·ã‚°ãƒŠãƒ«æŠ½å‡ºç”¨ï¼‰ã€‚
  - ç„¡ã‘ã‚Œã° base ã‹ã‚‰å¿…è¦åˆ†ã‚’ç”Ÿæˆã—ã¦ä¿å­˜ã—ã¾ã™ã€‚
- full_backup: å–å¾—å…ƒãã®ã¾ã¾ã®é•·æœŸãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼ˆåŸæœ¬ï¼‰ã€‚
  - é€šå¸¸ã¯èª­ã¿ã¾ã›ã‚“ã€‚å¾©æ—§ã‚„ base å†æ§‹ç¯‰ã®ã‚½ãƒ¼ã‚¹ã¨ã—ã¦ã®ã¿ä½¿ç”¨ã—ã¾ã™ã€‚

è§£æ±ºãƒãƒªã‚·ãƒ¼ï¼ˆSPY å«ã‚€ï¼‰:

- backtest: base â†’ full_backupï¼ˆrolling ã¯å‚ç…§ã—ãªã„ï¼‰ã€‚
- today: rolling â†’ base â†’ full_backupï¼ˆrolling ãŒç„¡ã‘ã‚Œã° base ã‹ã‚‰ç”Ÿæˆã—ã¦ä¿å­˜ï¼‰ã€‚

è£œè¶³:

- æ—§æ¥ã® `data_cache/` ç›´ä¸‹ãƒ•ã‚¡ã‚¤ãƒ«ã¯å‚ç…§ã—ã¾ã›ã‚“ï¼ˆç§»è¡Œæ¸ˆã¿ã‚’å‰æï¼‰ã€‚
- SPY ãƒ•ãƒ«å±¥æ­´ã®å¾©æ—§ã¯ `scripts/recover_spy_cache.py` ãŒ `data_cache/full_backup/` ã®ã¿ã¸ä¿å­˜ã—ã¾ã™ã€‚

## å‹ãƒã‚§ãƒƒã‚¯ã¨é™çš„è§£æ (Windows / UTF-8 å¯¾å¿œ)

Windows ç’°å¢ƒ (cp932) ã§ `mypy` å®Ÿè¡Œæ™‚ã«ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ä¾‹å¤–ãŒç™ºç”Ÿã™ã‚‹ã‚±ãƒ¼ã‚¹ãŒã‚ã£ãŸãŸã‚ã€UTF-8 å¼·åˆ¶ãƒ©ãƒƒãƒ‘ãƒ¼ã‚’ç”¨æ„ã—ã¦ã„ã¾ã™ã€‚

### ä½¿ã„æ–¹ (éƒ¨åˆ†ãƒã‚§ãƒƒã‚¯)

```bash
python tools/mypy_utf8_runner.py core/system7.py core/system6.py --no-incremental
```

### ä½¿ã„æ–¹ (ä¸»è¦ã‚·ã‚¹ãƒ†ãƒ ã¾ã¨ã‚ãƒã‚§ãƒƒã‚¯)

```bash
python tools/mypy_utf8_runner.py core/system1.py core/system2.py core/system3.py core/system4.py core/system5.py core/system6.py core/system7.py --no-incremental
```

ã‚ªãƒ—ã‚·ãƒ§ãƒ³ `--no-incremental` ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç ´æã‚„ KeyError å›é¿ã®ãŸã‚é–‹ç™ºä¸­ã¯æ¨å¥¨ã€‚é«˜é€ŸåŒ–ã—ãŸã„å ´åˆã¯çœç•¥å¯èƒ½ã§ã™ã€‚

### ruff (Lint)

```bash
ruff check .
```

ä¿®æ­£ã‚’è‡ªå‹•é©ç”¨ã—ãŸã„å ´åˆ:

```bash
ruff check --fix .
```

### Codacy ã«ã¤ã„ã¦

Windows ãƒã‚¤ãƒ†ã‚£ãƒ–ã§ Codacy CLI ãŒå‹•ä½œã—ãªã„å ´åˆã¯ WSL çµŒç”±ã§ã®å®Ÿè¡Œã€ã¾ãŸã¯ `ruff + mypy` ã®çµ„ã¿åˆã‚ã›ã‚’æš«å®šåˆ©ç”¨ã—ã¾ã™ã€‚

## å½“æ—¥ã‚·ã‚°ãƒŠãƒ«é«˜é€ŸåŒ– (latest_only æœ€é©åŒ–)

Systems 1â€“7 å…¨ã¦ã§å½“æ—¥ã‚·ã‚°ãƒŠãƒ«æŠ½å‡º (`scripts/run_all_systems_today.py`) æ™‚ã« `latest_only` æœ€é©åŒ–ã‚’æœ‰åŠ¹åŒ–ã—ã¾ã—ãŸã€‚ã“ã‚Œã«ã‚ˆã‚Š:

- å½“æ—¥å‡¦ç†: æœ€çµ‚è¡Œã®ã¿å‚ç…§ã—ã¦ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æˆç«‹å¯å¦ã‚’åˆ¤å®š (O(éŠ˜æŸ„æ•°))
- ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆ: å¾“æ¥é€šã‚Šå…¨å±¥æ­´èµ°æŸ» (ãƒ­ã‚¸ãƒƒã‚¯ä¸å¤‰)
- è¿”å´ã‚¹ã‚­ãƒ¼ãƒ: ã™ã¹ã¦ `{date: {symbol: payload}}` ã«çµ±ä¸€

ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆç­‰ã§å¾“æ¥æŒ™å‹•ã‚’å¼·åˆ¶ã—ãŸã„å ´åˆã¯æˆ¦ç•¥ `generate_candidates` å‘¼ã³å‡ºã—ã§ `latest_only=False` ã‚’æ˜ç¤ºã—ã¦ãã ã•ã„ã€‚

## è²¢çŒ®ã‚¬ã‚¤ãƒ‰

- ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯å‘½ä»¤å½¢ãƒ»ç¾åœ¨å½¢ã§ 72 æ–‡å­—ä»¥å†…ã€‚
- å¤‰æ›´å¾Œã¯ `pytest -q` ã‚’å®Ÿè¡Œã—ã¦ãƒ†ã‚¹ãƒˆã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

### ã‚³ãƒ¼ãƒ‰å“è³ªç®¡ç†

#### pre-commit ãƒ•ãƒƒã‚¯ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆå¿…é ˆï¼‰

åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ™‚ã«å¿…ãš pre-commit ãƒ•ãƒƒã‚¯ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„ï¼š

```bash
pip install pre-commit
pre-commit install
pre-commit install --hook-type pre-push
```

#### è‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

VS Code ä½¿ç”¨æ™‚ã¯ä¿å­˜æ™‚ã«è‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãŒé©ç”¨ã•ã‚Œã¾ã™ï¼ˆ`.vscode/settings.json` ã§è¨­å®šæ¸ˆã¿ï¼‰ã€‚ä»–ã®ã‚¨ãƒ‡ã‚£ã‚¿ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ã€ã‚³ãƒŸãƒƒãƒˆå‰ã«ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼š

```bash
# å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
black .
ruff check --fix .
isort .
```

#### ã‚³ãƒŸãƒƒãƒˆå‰ãƒã‚§ãƒƒã‚¯

pre-commit ãƒ•ãƒƒã‚¯ãŒä»¥ä¸‹ã‚’è‡ªå‹•å®Ÿè¡Œã—ã¾ã™ï¼š

- **pre-commit ã‚¹ãƒ†ãƒ¼ã‚¸**: ruffã€blackã€isortã€åŸºæœ¬ãƒã‚§ãƒƒã‚¯ï¼ˆtrailing whitespace ç­‰ï¼‰
- **pre-push ã‚¹ãƒ†ãƒ¼ã‚¸**: 
  - mini ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãƒ†ã‚¹ãƒˆï¼ˆcore/common å¤‰æ›´æ™‚ï¼‰
  - å“è³ªé›†è¨ˆï¼ˆruff/mypy/pytest/bandit/radonï¼‰
  - **black ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå³æ ¼ãƒã‚§ãƒƒã‚¯**ï¼ˆãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¼ã‚Œã‚’é˜²æ­¢ï¼‰

#### ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå•é¡Œã®å›é¿

å¤§é‡ã®ãƒ•ã‚¡ã‚¤ãƒ«ç·¨é›†å¾Œã¯ä»¥ä¸‹ã®æ‰‹é †ã§ã‚³ãƒŸãƒƒãƒˆã—ã¦ãã ã•ã„ï¼š

1. å¤‰æ›´ã‚’ã‚¹ãƒ†ãƒ¼ã‚¸: `git add -u`
2. ã‚³ãƒŸãƒƒãƒˆå®Ÿè¡Œ: `git commit -m "message"`
3. pre-commit ãŒ black ã§ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ â†’ è‡ªå‹•ä¿®æ­£ã•ã‚Œã‚‹
4. å†åº¦ã‚¹ãƒ†ãƒ¼ã‚¸: `git add -u`
5. å†ã‚³ãƒŸãƒƒãƒˆ: `git commit -m "Apply black formatting"`

ã¾ãŸã¯ã€ã‚³ãƒŸãƒƒãƒˆå‰ã«æ‰‹å‹•ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼š

```bash
black .
git add -u
git commit -m "message"
```

#### pre-commit ãƒã‚¤ãƒ‘ã‚¹ã®ç¦æ­¢

`git commit --no-verify` ã¯ä½¿ç”¨ã—ãªã„ã§ãã ã•ã„ã€‚å“è³ªãƒã‚§ãƒƒã‚¯ã‚’ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹ã¨ã€CI ã§å¤±æ•—ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

#### pre-push ãƒ•ãƒƒã‚¯ã®å‹•ä½œç¢ºèª

åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å¾Œã€pre-push ãƒ•ãƒƒã‚¯ãŒæ­£ã—ãå‹•ä½œã™ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ï¼š

```bash
# ãƒ†ã‚¹ãƒˆã‚³ãƒŸãƒƒãƒˆã‚’ä½œæˆ
echo "test" > test_file.txt
git add test_file.txt
git commit -m "Test pre-push hook"
git push  # ã“ã“ã§ pre-push ãƒ•ãƒƒã‚¯ãŒå®Ÿè¡Œã•ã‚Œã¾ã™
```

pre-push æ™‚ã«ä»¥ä¸‹ã®ãƒã‚§ãƒƒã‚¯ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ï¼š
- Mini ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãƒ†ã‚¹ãƒˆï¼ˆcore/common å¤‰æ›´æ™‚ã®ã¿ï¼‰
- å“è³ªé›†è¨ˆï¼ˆruff/mypy/pytest/bandit/radonï¼‰
- **Black ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå³æ ¼ãƒã‚§ãƒƒã‚¯**ï¼ˆå…¨ãƒ•ã‚¡ã‚¤ãƒ«æ¤œè¨¼ï¼‰
